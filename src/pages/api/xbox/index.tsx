import axios from "axios";
import Cors from 'cors'
import { GetServerSideProps } from "next";
import { api } from "../../../services/api";


const cors = Cors({
    methods: ['GET', 'HEAD', 'POST'],
})

function runMiddleware(req, res, fn) {
    return new Promise((resolve, reject) => {
        fn(req, res, (result) => {
            if (result instanceof Error) {
                return reject(result)
            }

            return resolve(result)
        })
    })
}

export default async function handler(req, res) {

    await runMiddleware(req, res, cors);

    const response = await axios.get('/webblendredeem?lang=pt-BR&market=BR&control=redeem&mock=false&metadata=mscomct&lang=pt-BR&cid=a78287f79f56ddc1&xhr=true&X-Requested-With=XMLHttpRequest&_=1623520217604', {
        headers: {
            Cookie: "display-culture=pt-BR; MC1=GUID=c16b320d2afc4ddeb22394adbfc0adab&HASH=c16b&LV=202105&V=4&LU=1622066764682; MSCC=cid=vzsd4vh2af1mtzfydvgnvs6z-c1=2-c2=2-c3=2; MUID=0A9FF8FF7FEC657E086AE8FA7E5A64CC; _mkto_trk=id:157-GQE-382&token:_mch-microsoft.com-1622074930494-30943; _cs_c=0; _CT_RS_=Recording; WRUID=3309642234806449; WRUIDCD03072018=3316667864219931; ClicktaleReplayLink=https://dmz01.app.clicktale.com/Player.aspx?PID=1011&UID=3316667864219931&SID=3316667864219931; _uetvid=f9c629e0c26711eb9249a155e0aad6cb; _ga=GA1.2.1205331116.1622517766; aamoptsegs=aam%3D12322074%2Caam%3D12321301; aam_uuid=11062451314358537881498287062699608140; _gid=GA1.2.1370450201.1623283952; ASP.NET_SessionId=4z2rwqeotq0ocofets1tnjz4; MSNRPSShare=1; fptctx2=H3ihr9e92IdW6yd1ZgQ9S5rgl8oOzJXlGHKxtZ4bVKrnCEhahk3B35wzI6et6yURNjZD8zIhawFkq2SxcFMqsoyXNr%252b%252fQxYxWZoPSvr0j4XPh1Y3LMIDW919WHEfn95AYoMrIUHiSWuOdGkQ1jM7prmO91Nig7D7KjShJgjeVSiyovlCfKsbrQEFZFpwNgZ3wbF1EM5W%252bqMtVojtlICVArdN%252b743IJIAmvOZLjoW94Hd9k%252fzK1X6GPBvbUdSZTj4CfVyQSFGQR7g8Xe7qwCMBu2PBTotDSG0bezsvc2RoNw%253d; at_check=true; AMCVS_EA76ADE95776D2EC7F000101%40AdobeOrg=1; ANON=A=CAAF345D8AE8E86C46311BFBFFFFFFFF&E=1996&W=2; NAP=V=1.9&E=193c&C=lFIY0lITDLmclX_dEAjpLoXEGzL4P2QbQNEsmVsAUqwbH-loyjQtTw&W=2; AMCV_EA76ADE95776D2EC7F000101%40AdobeOrg=1585540135%7CMCIDTS%7C18789%7CMCMID%7C11523789172275074111472328214423920963%7CMCAAMLH-1624035627%7C4%7CMCAAMB-1624035627%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCCIDH%7C1839229455%7CMCOPTOUT-1623438027s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18797%7CvVersion%7C4.4.0; mbox=PC#570cfa7d5e7e42c4ae0d0d71227db183.34_0#1657617526|session#bf249bc974f24007bf76e4d94829b142#1623432677; _cs_id=9e573d8b-16c5-a65c-f1b1-125df70667b4.1622074930.8.1623430827.1623430817.1613561419.1656238930741.None.1; __CT_Data=gpv=16&ckp=tld&dm=microsoft.com&apv_1067_www32=14&cpv_1067_www32=14&rpv_1067_www32=14&apv_1011_www32=2&cpv_1011_www32=2&rpv_1011_www32=2; me-ct=1; MSCOMRPSSecAuth=FACaBxRUzyIE6vaYt7Vsn1ezurwSQOtYJQNmAAAEgAAACLaVSBFfwkT6WAeSunzf/xI3LMnbbeIxUg38W00JtFljXKrSchKsiQxiNS7ZPO8yd9NaiQBeWTb3PNh0WBG%2BehZileNoxyuA3LeHV67WDghWY0oM75ET8fk5iFRX7s6Yfrvr1dMakH7JLMRc298zP4zA4rGo%2BDOsjbXEQtWjG2b7lZVtZmYI3LYiA7TkuA9l8v5tb9JsAmpdKlkQjklHDgnZJQqUxotCspfdcH5Ll3EScMvhBPufrro7pz7Jej6MZxLa6YeU%2BP7APVGAl/Tn7AUdiH3MrKJdrVQJY8O/uIAQ7/JQsu5LK6qLRinvUXlzkJxUQNRevys%2Bx0tgWGKN4zT5MqbOFOm9vjJOF6l1UvS3TibQBN/Yqo783amDTxku8yFzAxNuQHFcwHP54WOZ/VPWxpdsDyBrTpUJ82B2hePYW1ilj7dHmyZCS%2BqJJY5DWNEpiWFZUelSanGTsO12KgBCIljhyZU5jCmhuKbt%2BWxcTuTG8n8iVYxVCWifhByHk0F/dfJJDArsXNtpPSUX5tePPd4qBIO0PEbVCt5moFHBP/11GPRgG4fI87OTBZ2C7%2BNB69Z6Q%2BcnLzd/wppqHelivG6l2QV0GAtDYy6uqEgnr6%2B/eSXEPOOvwEtD42oN3U3hviOQV2P/mqQeHplKETR44zubQ5mDez3Ybn76GAXVfpyor0bf0C42Yj2tSg94YWHJf3/o8hdWu6Z/D5of/cynaV01dktPqAAD5aV7f3D7DkR6BtVwecO13/qaZ7gSmsRN0QC4kE3dxwiwHa3IvB%2Bh1QuQJNvCnZSLd4t%2BqslI9d92XGGXlfBRP2pd9wZuUCi37/lWhPp4ALa3pN/2htGKhTInqgqa5x0XGPd1OY1YRPGsskzQm1nLTsttRdMKloL5WORDIvqHU919rwD7sJfsVdgTgGus3d0JGwge/ePG/VcZ3wZat7bRgPgmx%2BDqMSK7MUhXy6pr17kz2mUXrWuq8kSzTfHA/dFlw8CnNlNgLnbENuR7pvjKfbst7gBfMeV/QBf2rjUmmtAKDOvemKJrCVrn3e2Zp07Mkt/Ryige2htIpw5kLHAg4bIXjIn3u75ps50sBY87MFjHRlhUYzWeN%2BI1BVL5j6Bc2MrMPyS0u9HdsnCSjdRsbCNnsZuuW/5e1Sa87NCApMn9evGAPquoiYOoQ2dHyNP/x/sl%2BIMT8hRutV3h7RG74K2hM2N0SLu1tSK3OX5H3YFe7P7z42jUOAvRdzhDPMGYhl63Xaf%2B2Uf5oaifuEl%2B2LiR0TkQzITu5CljjY117B/%2B7L7%2Bk28w%2BYhkjOAH2KlS7uxwbuhhpyghw/AjLEMYQsvNyA2O5bRnelu1FiWjGJ1kOC/nsWyLpW7eJhqFVTFUmYqk31%2BUbiqhVt8V7GifQnEEHOVHcexl6NbMSOicfrpCy4YO9d2Q1a%2BAyNkOTQQ/6GOj%2B4Zwlijjl9KA/TLTi4JPd0gfdoqOZYTWBCsmSUDW5b7ET/RwUqnLPg19Iqh0N/u0jCf4UhTOdLDpKm07Hw5iOuf%2BXiI1FYpEEeynQRJmFZaHELw7eA5VPSPVnR2okpG1JL7wDSOty%2B0UAFQv5Wz80VN6Xlnhm8mE0Z2z8Y3367TPkG2C9N5izSXBgKiWYfVZ9jL/KP6DwCExglUQ0DsF6TvAc3XD3AkOXe8Z1gMsDMp0cvcUkuDj/Qh8dH7t77yoGCsvq5CQ7JA%2BewDTHKuyCXDsG4xMKxEldpiu08d2KPz4mE/QzUF%2B7dACuUO%2B/28DApRUVdJV0xG6/GfmlFlrvdeTH4e8GiOJuLS7RADr2ssBs30Dl6DAbVhf9GhUXTSBwnwzNBK1Hl%2BbHM2kwUmOrY7TcAZHd8L37q3iF9HzFWUPp8nSGzgUUN/mM6KV9iMa/yVBysG/eLqDpthoNau%2BMFYHClf9nQnP01vL8SZEbNKnJGC/eidu1KLKjXbs%2BFFIzr2R%2BAJjKNnRNo%2BUkPtQDZnEMB/W9QYsFW6LgkhXYdcoUr4HsXRX%2Bt3xdyOQuTYIKIa%2B46mM4SqCTZVr9bkTBHK/89d4lRimq5b06PlNlbAKBG8Oo499l8VvzJaxr9ddXRLkaUm7T2xE16GSeqqxgMW2RFASyBLZxTV8xfBy1/NQoNNNTHpexFg6XQxBE9uYBxbOz1G%2BKDfV1EPcl7pPFu13ZcqLZ8nBZnPYd5wupwb35ZQf7PZaBoQvhxticnm3xIFdPBmwZD61PHjTiR6JCBSyHXucUGXM9G4TYse%2B0I9DDFEkB7v6na1WRceAZN9w9pAmtfwYOB5NLsdEPLWBr%2BbBged2emEKiqEZxwBojVKQoA%2BTF8oq3LjQhxID6XH/0lLMJamWVSe3HL9bk9gR05Ny2V4uXjitYvdioCdAvddnOcqRj08dgdS7UDrzCgMYp3yUGyUoRx48xmswnLyBzEQ8kOsXg%2BdTuloXJXQJy2NocwF1cqWE0i2HKQfZBcX%2BVGh9dlmxDRkGBAIXEOJkk30vPG4XbDBy/DvQBilOEKTuQauA4xQAiu8haIJvVnU7iZ0OEWAYTZxoZCo%3D; MSPAuth=2gsb3RWMbGD1ctU21B*L0dkbXczLrGHVwahmyFEHn3J4Qh0iUcM7cO*P2!N0FFIUIBhXe5ektd2uU2H9hWz9qmdmExKegDfAw*s1RHp!Iv8OUO4T1r0qRkwRqrlt1Ea5PgzYwWEO*mGCM$; MSPProf=2DNMoM!tfFKvNbRKzgd4RWXnZM1jOIb!cSplHv88GioD1zKDy1Zsmf*RUsWmKJzMfoo4QMLjysaf*07yUzaHb8WW48SlFye3*bFYkqHcef2voroGHriVWB*nwhZfv4Wn19JUai!gbBtZvXybmdXX4Ry8nNVosYajHstZWcyeWbG698U0qMMJ8hIUOi3RK7F5ks8yh00FNqmWwel2!F5Y2v1KidyBQMo0C3; ANON=A=CAAF345D8AE8E86C46311BFBFFFFFFFF&E=1998&W=3; NAP=V=1.9&E=193e&C=izIbUW5dHS_x49K4U0tKYP1m9Kot6jjQ_HtrGBxfO9q9RCjtdVEtaQ&W=3; InsiderGroups=a78287f79f56ddc1-insider; MS0=7b7b83e24f8f437ba6c389e15e40ca19; MS-CV=sHhtu+q7/USOKrTX.1.0"
        }
    }).then((response) => {
        return response.data.metadata.mscomct;
    })

    res.status(200).json({ 'Authorization': response })

}