import axios from "axios";
import Cors from 'cors'
import { GetServerSideProps } from "next";
import { api } from "../../../services/api";


const cors = Cors({
    methods: ['GET', 'HEAD', 'POST'],
})

function runMiddleware(req, res, fn) {
    return new Promise((resolve, reject) => {
        fn(req, res, (result) => {
            if (result instanceof Error) {
                return reject(result)
            }

            return resolve(result)
        })
    })
}

export default async function handler(req, res) {

    await runMiddleware(req, res, cors);

    const response = await axios.get('https://redeem.microsoft.com/webblendredeem?lang=pt-BR&market=BR&control=redeem&mock=false&metadata=mscomct&lang=pt-BR&cid=2747c49045b247bc&xhr=true&X-Requested-With=XMLHttpRequest&_=1624722783485', {
        headers: {
            Cookie: "display-culture=pt-BR; MC1=GUID=c16b320d2afc4ddeb22394adbfc0adab&HASH=c16b&LV=202105&V=4&LU=1622066764682; MSCC=cid=vzsd4vh2af1mtzfydvgnvs6z-c1=2-c2=2-c3=2; MUID=0A9FF8FF7FEC657E086AE8FA7E5A64CC; _mkto_trk=id:157-GQE-382&token:_mch-microsoft.com-1622074930494-30943; _cs_c=0; WRUID=3309642234806449; WRUIDCD03072018=3316667864219931; ClicktaleReplayLink=https://dmz01.app.clicktale.com/Player.aspx?PID=1011&UID=3316667864219931&SID=3316667864219931; _uetvid=f9c629e0c26711eb9249a155e0aad6cb; _ga=GA1.2.1205331116.1622517766; aam_uuid=11062451314358537881498287062699608140; aamoptsegs=aam%3D12322074%2Caam%3D12321301; _CT_RS_=Recording; _cs_id=9e573d8b-16c5-a65c-f1b1-125df70667b4.1622074930.14.1624345090.1624345079.1613561419.1656238930741.None.1; __CT_Data=gpv=33&ckp=tld&dm=microsoft.com&apv_1067_www32=31&cpv_1067_www32=31&rpv_1067_www32=31&apv_1011_www32=2&cpv_1011_www32=2&rpv_1011_www32=2; me-ct=1; ANON=A=CAAF345D8AE8E86C46311BFBFFFFFFFF&E=19a3&W=1; NAP=V=1.9&E=1949&C=yrKQqffXFyFP_k_xf6JBdWpCCuUWdeukNxquY2OV7aPCflBsyidOCA&W=1; AMCV_EA76ADE95776D2EC7F000101%40AdobeOrg=1585540135%7CMCIDTS%7C18804%7CMCMID%7C11523789172275074111472328214423920963%7CMCAAMLH-1625189220%7C4%7CMCAAMB-1625189220%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCCIDH%7C1558211478%7CMCOPTOUT-1624591620s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18807%7CvVersion%7C4.4.0; _fbp=fb.1.1624584421901.1136163943; mbox=PC#570cfa7d5e7e42c4ae0d0d71227db183.34_0#1658771292|session#6a8855b1c18a4cdaa63e6d8897350588#1624586280; ASP.NET_SessionId=epj1rtzubs0a5ohotpyzxhmt; MSCOMRPSSecAuth=FACaBxRUzyIE6vaYt7Vsn1ezurwSQOtYJQNmAAAEgAAACHtPwUIaXcqWWAfiO0JxKJfuJKingGbYuiEbTNt36TOpKDAbYMbp8y7Q1SEBBGg1BCWXnTJk5f11%2B964oGKsIxz0y2NRiXVMku2YuU2rliE5vHCu6ZY06FJcqEIlCZHAtTwCLEGA4kTopGQ4mXX/za5i6g9rVvujUbdoDaUpJVczDmw6pNK%2BOs5AEJ8zw4Ts30ZDtPTl80Ws4krZwBP5Lxeutf3PIlImyN3O9eWesUTfAi47R48HKwZID4xIDSOdqYGsepIIYKaF%2BC%2BFiFJotDUHbzVykXw71fxBiHgdkLPKSt8gF3I%2BUn2Gq/HfE0lFx8UA7ghsl0VqAGl2kV4FDPAJ67XVNpGchnZWTJPq354s7l9tVzSsd4RLn1f0WHE8Uoqr/q8%2BPmmMMII%2BNvveM1ApVkmwppVyUg8CMdsrTx8T3GpRA/XYW0picv7Fnh58Rsq9lBzNbyI1zIHUUI8YMM72DVIjTyoYSbIyKs0T8cvBLnK1O%2BXY4ZLLeGXaXEXXvqMyq7fI6EPyH3WOX5EB8L9TrMjjLIhsrMA0kcySis3UTrUfMSs3lto/p3Woyg0xS9bvfPSUw%2Bya7dTjudjA4FX0GrXL0EUrkiddx1NZyJL5inClU7cuebZFlJ/ndQVFvQETbZWirPfAjg4Ayu45UFg9x%2BlHur24xguZ9VgKlF5x4jW3yVfbOQVOMzGraKQHuLWZZ5nG7GIBXfI4QkTemoR0bmCN2wobALsW5%2Bgv%2BVJVHGCry9/iExIuGxW242mtg3WSLeBp4XZbWdRUX8WDpS2wbGBU4xUQY1uhBGPhwxV9dtDmLS//j%2ByL15MzbXk5wAvpJ5F5EMP2coB2waa1O5xtRAY3fy/CsGlTq0MGuu%2BYvBOi0GdVhAOKDpJa/rq1QBof%2BgQwwP19mBfrKrDwyB/2%2BDUscelO0PFdT5kzDu%2Blf8Y/nWqKkbuAmddd7KWaPW%2BjhXICQIZaFHTEpICUKVnS2nB%2Bgblpw7z4azT4yRAILgf9mNHe5BVUnnSh4A1DW2huq/PNLK/bc443qBQMZ3HdslkYblcB1B5%2Bgls1Ute8Bu7pdLer662xMBt%2B7SjJbc7kyjXDRzGBkK8ZEv4oPuDRpfEwqhXEsvbqBtJyBXAlWE8jcUczOvS%2BIuCM7FYHbNOYwV1Vdxk%2BHXJ0xgr7NIkS9TYbSJ%2B5ezYrt0G8AHa/dmDFV5bI3usL06rWJ/BqNMN8jvV5H0%2ByHJ/uThDROrAfF9wH3GlCp057%2BYGq7hH4PBxL3hUjFIyv6DDZPOHtJ0V3Zg2AnS83OS0Ux0ovTquLylITFSRQdDV02sWpibVoNekJBDpCiP%2BWsvLBOxNyM4ZNMBc44JGBVVIwIy1EtC4sQd0dU39MZgq%2BzSC7wpB/V8eH8Ysu6iZSJhNH8zdGx8SGJiTL/c95q8pW5cONCP2VSNEDTLos5v7pX0QADR6IsRUm4KWf1gWJjL7XDeDbBJ%2BXNS%2BuH2pm50gFNo4FIZ8sbOCs5PxEUWaW7fKVe2Fm/ecmUWLwFPlS81E/bU3d2VYrFJkvknzf9CVLFyaL2L7i%2B8xWPgE1wGpMTb4yxpHQdC%2Bwesbyx%2BOykBiWustoMGYbrykDrlNbHsBusNtPj3tc89BZMoT9%2BdCM3CQSmNH8NP8bGKwvV%2BNKLcxx/sBZX3gEStybwK8C5qEMSmte6wkcwbjoHX%2BzSmZlBO6JjmupS85tGB0JdZHvM1YAp1BS%2Bl1Ik80Njkmioj5GlRZEIuku1kBAOxepGhJwYf0pE8Psql3LqGwznlBWzhEb058Eif4v1XR2Bpy0ieJlhpz5wtxcKzu6IVMbiSpUG9tITuGo3ltb84KKnQASnvodXS2FT7tkbijCTIAEIV%2BUs21cv6Bmy3h9gylcqzRZBsXxStHnz6tfQvdd/TXMNlRX1Q8NKRrt9kfzZicayfg7HsOdFJ3JE9SrXRwIg7GYx1nITh7b6CXRgH/YjdAYCC9DPLBmsMSJBArix71GWRQ4PxO4ytlLHC4utLm4EGY2ZSUM9FB17R9g%2BOSMitsNsfScmsyyqh7rxCMTBxAPDHT8qKkM9vIe92MHJwb%2B3%2BREB9hSLZRNvXkZO7Oy7RjFOobj4/5eAkCg/HKPtYO65LrWYWbMnguLxnZ4VCValCUzrtdpNGHP17k5crH43JNr1KFAkCeETSKU0R49yISo8mt%2BxU57%2BwS4g4KczG/P6YEkqDpmvEZW8ZWSG3qpBT9Q7tMgR7ljpHMdtDhrWonyK3jerrV3bd1SCwdOLxgULCGYKMTGdH5lbAVCDbssgttrl5xaKYfT0Dw6z7vTWKIJRbhKRVHLOgkVPcglVLJt0W4K9VGssMMRaG4pWks3YFvusw0W0o%2B5Tlu9Bvudt/npT01GTB5fCYDYs4sJQvALIGxpgNhmHJx5dXKQSz5MhQYBhLfcTCtpvmKHkGR5tdRjqRO6gxmexs5g3zAQDRfKmF6PwwipX91QapxxpgvmSgX%2Bi/FM0x4I3jdhfcO0Rvw7kl2tDjVw20KXnBQA0drcbYMqBCg0FAFWQPHCsuRNnlU%3D; MSNRPSShare=1; MSPAuth=2qoa6th8pFvbhI0OtC1mJyHRDAyplR6*Eia3GW3MlY0RNv9BtwmSy8E*jndXCsJd5WZO8p!Qqp*AYpg0ul7rvjR7khV81T6!ne7!JPSxxC*!z8W5RfXgUo8j0*Wyd7wsxLUeEtQ3kX3Ly2lYtbINbFtvvnBWRHYpRD; MSPProf=2Tyd1mGFMHXVuwGOCLaK8bUDPK2!9QarmtyY86w312C!G1DCS69ySWv0gOL4XxpwcGwTUTxOmpWzF6ybniLPfVek1ZGijIUC9TMUxiz9mlQzXUuWfA*C3X*GNk8dx!ZxkxxZ2BXAkshxIo*R1uK7*EWOuR*eLRevDBEv!LlDhg69!uzp4!ZzoQHbBHZ0urVnLBZIasUjcy9h4EoL5KUUihdA$$; ANON=A=3547CB54ACF2832A5CCBAE8BFFFFFFFF&E=19a5&W=1; NAP=V=1.9&E=194b&C=3OcrnS_knN547a2GrmTC0IGvOMH7-O-oAKGExsOut5D_-O-LlLf9qA&W=1; _gid=GA1.2.308521373.1624667538; InsiderGroups=2747c49045b247bc-; MS-CV=OFrBWriw0UiKpU3+.1.0"
        }
    }).then((response) => {
        return response.data.metadata.mscomct;
    })

    res.status(200).json({ 'Authorization': response })

}