import axios from "axios";
import Cors from 'cors'


const cors = Cors({
    methods: ['GET', 'HEAD', 'POST'],
})

function runMiddleware(req, res, fn) {
    return new Promise((resolve, reject) => {
        fn(req, res, (result) => {
            if (result instanceof Error) {
                return reject(result)
            }

            return resolve(result)
        })
    })
}

export default async function handler(req, res) {

    await runMiddleware(req, res, cors);

    const response = await axios.get('https://redeem.microsoft.com/webblendredeem?lang=en-US&market=US&control=redeem&mock=false&metadata=mscomct&lang=en-US&cid=a78287f79f56ddc1&xhr=true&X-Requested-With=XMLHttpRequest&_=1628087571952', {
        headers: {
            Cookie: "MC1=GUID=c16b320d2afc4ddeb22394adbfc0adab&HASH=c16b&LV=202105&V=4&LU=1622066764682; MUID=0A9FF8FF7FEC657E086AE8FA7E5A64CC; _mkto_trk=id:157-GQE-382&token:_mch-microsoft.com-1622074930494-30943; WRUIDCD03072018=3316667864219931; ClicktaleReplayLink=https://dmz01.app.clicktale.com/Player.aspx?PID=1011&UID=3316667864219931&SID=3316667864219931; _ga=GA1.2.1205331116.1622517766; _fbp=fb.1.1624584421901.1136163943; IR_PI=a0a71ceb-ddce-11eb-b30b-a123e6f5a3be|1625602909297; display-culture=en-US; ANON=A=CAAF345D8AE8E86C46311BFBFFFFFFFF&E=19b6&W=a; NAP=V=1.9&E=195c&C=KjHUuBcOkNGCRQ65kPKIKPieXKdmYomzWTvgzdeTDuJ6VKa2kSTG-A&W=9; ANON=A=CAAF345D8AE8E86C46311BFBFFFFFFFF&E=19b1&W=9; NAP=V=1.9&E=1957&C=_z4VRRT5pKZVmdJOreCT7P6DGeErgPE0UX5a06QkneUdXX2fhswIgw&W=8; MSCC=cid=ts7b2c5higvuiw6oldujkkcs-c1=2-c2=2-c3=2; MSNRPSShare=1; fptctx2=H3ihr9e92IdW6yd1ZgQ9S6iHaRiejIdk0aIJJ5j7uH4XSaCNwGn7p7gQ4ZpAC0VMEegfeOT8DX9wg1cEp3l%2b9%2bZSf%2bKuqPt2tG7dSRavZ%2fu5lKOsU1148uHv9uYsARBVw5q%2fDzBNmWLbD6iB1bp0QoOp4YLoUFR49I1MEDlyFvq%2beIymSULrtTetf7Tn724mEpozHsMYMZgkV8Pz2qcyQ7RNAa99g9FEyjykDeeFjtE6guquuSJZIwkrKdLqhatBa8zGGkAgF5qE7FU1bwAsbK1jXOLOHMerouTjqlQoYJc%3d; me-ct=1; MSCOMRPSSecAuth=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; MSPAuth=2XmjuqrG9GX8Z1UKOx4Mw1Y5xpLbyhRhaCBONeYP5H!YiL3i5Cmzwdd1T9QcqWeH14yyS9Vy8FHdcfsTk8ElNJWSzsbNGVdsDGA0fOwKlheI9knAMW1mwqI2NhBVnyZHqw7j57XL6Zhx8$; MSPProf=2PYv**39BFe79xTTDktfJE649LZ2EK!5XOGLL37TFoT3K*GUe4vYPwgqIGa2nH6x1u9DBHPGFnVpS978X9fS5u9lDADcPIvQ4VO1YyQRNhNkPSCYkN6xSrI8wajMNFN!7hq6ZALGLSlQZn!BaTw0BXTze*2Sf8hsfIZH6IvVkoss!4u7bXLrJ1s6*ZLa5!M!*rnulTUyuLJyujMMBplVaQhS7b8bsGikpM; ASP.NET_SessionId=icdzvmdmb30snh0u5lbmbe1w; InsiderGroups=a78287f79f56ddc1-insider; at_check=true; AMCVS_EA76ADE95776D2EC7F000101@AdobeOrg=1; _cs_c=0; _CT_RS_=Recording; WRUID=3407160628331237; LPVID=EzMjJkODc2YTEyZGEzMTdh; LPSID-60270350=GuhOoH4eQEGKZpFh_WZ0nA; AMCV_EA76ADE95776D2EC7F000101@AdobeOrg=1585540135|MCIDTS|18843|MCMID|32606165887524311583660282503796334325|MCAAMLH-1628631815|4|MCAAMB-1628631815|6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y|MCCIDH|1839229455|MCOPTOUT-1628034215s|NONE|MCAID|NONE|MCSYNCSOP|411-18850|vVersion|4.4.0; mbox=PC#570cfa7d5e7e42c4ae0d0d71227db183.34_0#1662213714|session#d131f6f9df01400aa39d9375b940568a#1628028841; _cs_id=9e573d8b-16c5-a65c-f1b1-125df70667b4.1622074930.19.1628027015.1628026980.1613561419.1656238930741.None.1; __CT_Data=gpv=2&ckp=tld&dm=microsoft.com&apv_1067_www32=2&cpv_1067_www32=2&rpv_1067_www32=2; _gid=GA1.2.175117795.1628030770; MS0=ebfdd3843d474d5bb4a77c02390c911d; MS-CV=e+5SBKCi/kyjd2eh.2.0"
        }
    }).then((response) => {
        return response.data.metadata.mscomct;
    })
    res.status(200).json({ 'Authorization': response })
}