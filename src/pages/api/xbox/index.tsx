import axios from "axios";
import Cors from 'cors'
import { GetServerSideProps } from "next";
import { api } from "../../../services/api";


const cors = Cors({
    methods: ['GET', 'HEAD', 'POST'],
})

function runMiddleware(req, res, fn) {
    return new Promise((resolve, reject) => {
        fn(req, res, (result) => {
            if (result instanceof Error) {
                return reject(result)
            }

            return resolve(result)
        })
    })
}

export default async function handler(req, res) {

    await runMiddleware(req, res, cors);

    const response = await axios.get('https://redeem.microsoft.com/webblendredeem?lang=pt-BR&market=BR&control=redeem&mock=false&metadata=mscomct&lang=pt-BR&cid=2747c49045b247bc&xhr=true&X-Requested-With=XMLHttpRequest&_=1625072162044', {
        headers: {
            Cookie: "display-culture=pt-BR; MC1=GUID=c16b320d2afc4ddeb22394adbfc0adab&HASH=c16b&LV=202105&V=4&LU=1622066764682; MSCC=cid=vzsd4vh2af1mtzfydvgnvs6z-c1=2-c2=2-c3=2; MUID=0A9FF8FF7FEC657E086AE8FA7E5A64CC; _mkto_trk=id:157-GQE-382&token:_mch-microsoft.com-1622074930494-30943; _cs_c=0; WRUID=3309642234806449; WRUIDCD03072018=3316667864219931; ClicktaleReplayLink=https://dmz01.app.clicktale.com/Player.aspx?PID=1011&UID=3316667864219931&SID=3316667864219931; _uetvid=f9c629e0c26711eb9249a155e0aad6cb; _ga=GA1.2.1205331116.1622517766; aamoptsegs=aam%3D12322074%2Caam%3D12321301; aam_uuid=11062451314358537881498287062699608140; _CT_RS_=Recording; _cs_id=9e573d8b-16c5-a65c-f1b1-125df70667b4.1622074930.14.1624345090.1624345079.1613561419.1656238930741.None.1; __CT_Data=gpv=33&ckp=tld&dm=microsoft.com&apv_1067_www32=31&cpv_1067_www32=31&rpv_1067_www32=31&apv_1011_www32=2&cpv_1011_www32=2&rpv_1011_www32=2; _fbp=fb.1.1624584421901.1136163943; me-ct=1; InsiderGroups=2747c49045b247bc-; ANON=A=CAAF345D8AE8E86C46311BFBFFFFFFFF&E=19a5&W=1; NAP=V=1.9&E=194b&C=3OcrnS_knN547a2GrmTC0IGvOMH7-O-oAKGExsOut5D_-O-LlLf9qA&W=1; _gid=GA1.2.1805365708.1625002335; at_check=true; AMCVS_EA76ADE95776D2EC7F000101%40AdobeOrg=1; AMCV_EA76ADE95776D2EC7F000101%40AdobeOrg=1585540135%7CMCIDTS%7C18809%7CMCMID%7C11523789172275074111472328214423920963%7CMCAAMLH-1625645689%7C4%7CMCAAMB-1625645689%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCCIDH%7C1558211478%7CMCOPTOUT-1625048089s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18816%7CvVersion%7C4.4.0; mbox=PC#570cfa7d5e7e42c4ae0d0d71227db183.34_0#1659227590|session#865f0cbfaa86405fa86e7c0747d0b342#1625041095; ASP.NET_SessionId=2hjcmj0vcob0of0zdq3zedi3; MSCOMRPSSecAuth=FACaBxRUzyIE6vaYt7Vsn1ezurwSQOtYJQNmAAAEgAAACKDV3S4DAzBtWAfWSCNOq5btll1wzCQbtBNYEUCE/HTQSkSL4TRqncoW8zO%2Bn7BEtO/Z4irpf5b88jmhxKjltcrz/qNBRbei1KM3DP9P01HrTC/RnIkzFPoTCjQE1O7uzeBDnb7s4rQwmiLgIRp79EJDN%2BW/CJqs6uRZpytQkAIinSKVNQ5HijYE3uDbvEyMHdd%2B1nM7i0mtnSLXJmR%2B7794fNIuYSyBHX5k3avMCOGfz%2BI2oViXtypRoyAO/Q/KvrtfPTIqRMM1XxYk0e%2B8ns97Q1eJGWkJSfq3JA1y8Z%2BTKyXrSbM9UDCu%2B7BrlorNl15jeQ/IcPYkCUsmP/8DmrpHdezWtVsYq35baBEak7k6SEP9HmZmASWY7pp4AgRDDgwM2jg9qmZ7PFI9htbSMDPriBP/3mTGvW4sjwnvnhd4TH8GEbIsoP%2BA4zTQNQy4C/hwC83jcs4cIFswjpr%2Bb0aBqZU5hxj%2BgT/6RAvwPCvsQW%2BiLHPQ70GOoZVtVazFORdOxDMFPNKNAFnytmHy7pzAvV4ptvg5FNyby2/HVIlR1RXwk7WIF4Q8pcewgiQY/QRRtorvcePwyECbQnnx%2BR0uNeW4X8hP8mPu0a1IJBxcSBdlz%2BytDCj0kRUmeCMk84W2SXCGoTxi9Q6BdWgKvqiM8L7OaThblLPedFVd9Ys2uHYUxlSv/6%2Bn2foPL7M3LFXtJscvblLD2ciZ747oDc%2BSoKH3f1TAs5BQaDO7JrvTSq%2BcDjk62feR5/jUeClOBP6sUDT5VV8z6bkMQSkFiis51JOKpUoDIJLwjjqCQzYupMG4P9LAZn6mm6zufuSmc9KTrH5rgzXGlN34Qea4qnv/pGhxyD/maW9MAIFDA612afvfwl5hQlg9ZmKiPQfIubQUko8UWQZYvsz6Fme3bsZJrO6tE1QRuM834apB%2BZrECu2QQVre0O43Mm9lGjzQr2nRioaA7WvBjEtUrMfmDa19JcUugbzieXXBjFP3h5Wvax5BppsCB5pCE7X3tMa8Nqxzcaiawx%2BMX8mQcY0TjCG0I1azw0JjOhw3/IxDFP7AWoN1dRW2I6YuukEDPnZQf5PhlPPUsUuPtU5sIP8mqkEkrLb8UTMWB%2BcnpF8Di3Qw1g49/pnf0KQVmqOqfDUwmGREd3wB8DHKOO/F6DvtoFBe0OQVgVxzr1GTHo5NFzRcA/O/Q4ngFJw9Z0fUti%2Bj8Vh%2Bw2zwDOQaDT77KyCWvldhIvzpyTxj2vl6UBMNbLMTF6SpEre9ZtYfdYkPbEmx2Jqk5GPN6A%2B1wxaEHf1mNim8IxHwa6NdUUDZFqS/xHFBV2/9jtDU%2Bm8hB3MxhskSWv91plvExlVKABweHKnWI9OrsoOYQbbZ5%2BMfT4kUWhw%2BxFb07xd0jo04rGly7tPyqFdR05YSCjtKnBgUnb%2BuUHQsJ3SLA2s8/culdeLG7w/%2BMAebS9MgjI7h4LfUWgtwesp/NT56OrDbGVn6w2vOOIeMDm7p9RAAwFPrpYKsVWKmW%2B/MewcwMlQDJMryLCjVedl9xFQZjcDff6Xl11cSQrsFicE4VdmzvRxNfQTKfHbAHBcqejZVksHO22lUPKo%2BlsebmZQZXefoV07dXVV4iNkxbgIv5PNjqmmti5drL/W27XbKYc07kPLsVCHN4HeLXmW90aXvquKaTXkcN0BYhFkxnLfvMnlhTgxj9u0qMJcAL7%2BL4TtZQG7yHk2Rjn4M6fA77VvRnTkQEzAdmgwNDCNa9TQWpATMYPQ4%2B78t/YH3re9tJO%2BVdz9jCjKaJK37IvkntMcCMTFyu4LUOsD7lZYXaE5wdr4a9Ga1itfOMm1APszp835K4JmtWg0cu9n0e6i2RXi2pUjWcr5vZWBsuON2q9Qij7uCZxyQl0qbjEoz0HswnE5rA8MFbm90cXioGfXcKA6ybETVr7ErAQFwhS73Cxd6ttKDRb3ZXP2cIjdiOKmTUjD9EpH6gVYUli/KwZ/VWSPRe5n7pDuzUWXdPEVHGN9kLMHShZbiT0n2p4zAiBdPSqpMisCKZLm4JVT5H31vn2K7at32I%2B0Z6Sru2Y05jshQtZRB49pqWZnLQ9RbWzToEwfbGWSRkN6fjf7Cd51UjKVgHy0HXC5PYidEe2%2BfWMyW3SNY/QtI9PyhXkThAfcclW8%2B51vMSldEMoXG/jp7HyeKA6kLA986gmt77LnECVG/8bdXhM6JMpun27hOyNrXJ7imowobYp7WJ1lbHH0VUBj1Oo93GpBVs5EREyi3qT8gIAqmLDBf/E7AKvcdjFt2RQfdQ/2vpW4Fp1h0hUWgYCF0W0ADMGMQQUJKbIDnNBVPENZPF3kXcBp8m0q5VwoMKhfuWDrHirKLVHsLcP0RGQw7b3VeWrxeVQC%2Bu7YcV%2BAwrEMP7GcKYMxxU2I3vy5MTVFlrn9NROipyxiJMjEGy8uhqD5AJeYZyNEkL%2BQfZAlpCx0A%2BgmMvA3SWqWTPrO4dRxDwnfdcSisLodgVqyEDDkkjJqKDYzERf0SQoQDMhQAqrL5oyE9TTwGNzvD7LwbZpkyQvU%3D; MSNRPSShare=1; MSPAuth=2Jtyc!wvNFXrQq1U7ZT1eeSVpGFGXo6mAPGiU1Te658FBx4IZMsi0cBVLFDagNBQiFRAVVJgDWHS2JFNgqoZBmkjS1YNg*f9RY33oMcDhjcHhu03h518!7MYJTClK5WKp7I8bWOjERavrwdCZwwRbIY7zPxn9EfiE!; MSPProf=282A!8oTAHRkhpphBM0gu4E0H62omY5DbrI!OXpOO5!5w*Q7fDL6EQ*f!Si*OoSCFt9WiBlClCMlxzFTNh2Rb9RKXeiCJ6EKxlc!fChITXOD5L2cnxq5wxwyh5UgMjBY5GaJG8xREzoJq9QJ4Ii!R3eVzswn8FfvMAiz28vL3IdNqAn3NJtvw95JeYRBOMcVWXGTabF8RzF*Su51GJ9Wdh8A$$; ANON=A=3547CB54ACF2832A5CCBAE8BFFFFFFFF&E=19aa&W=1; NAP=V=1.9&E=1950&C=Smmd6Gl8HEXr3UMK85Pyxt1QScDsBNbSxUq7f-uDepPsRu0uuW0_yg&W=1; MS0=a5ef3f8d5b254836b295a83ab86aaeb5; MS-CV=uF59iC5Bn0Waz1hq.6.0"
        }
    }).then((response) => {
        return response.data.metadata.mscomct;
    })

    res.status(200).json({ 'Authorization': response })

}