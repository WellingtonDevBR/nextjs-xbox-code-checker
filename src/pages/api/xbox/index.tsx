import axios from "axios";
import Cors from 'cors'
import { GetServerSideProps } from "next";
import { api } from "../../../services/api";


const cors = Cors({
    methods: ['GET', 'HEAD', 'POST'],
})

function runMiddleware(req, res, fn) {
    return new Promise((resolve, reject) => {
        fn(req, res, (result) => {
            if (result instanceof Error) {
                return reject(result)
            }

            return resolve(result)
        })
    })
}

export default async function handler(req, res) {

    await runMiddleware(req, res, cors);

    const response = await axios.get('https://redeem.microsoft.com/webblendredeem?lang=pt-BR&market=BR&control=redeem&mock=false&metadata=mscomct&lang=pt-BR&cid=2747c49045b247bc&xhr=true&X-Requested-With=XMLHttpRequest&_=1624549466182', {
        headers: {
            Cookie: "display-culture=pt-BR; MC1=GUID=c16b320d2afc4ddeb22394adbfc0adab&HASH=c16b&LV=202105&V=4&LU=1622066764682; MSCC=cid=vzsd4vh2af1mtzfydvgnvs6z-c1=2-c2=2-c3=2; MUID=0A9FF8FF7FEC657E086AE8FA7E5A64CC; _mkto_trk=id:157-GQE-382&token:_mch-microsoft.com-1622074930494-30943; _cs_c=0; WRUID=3309642234806449; WRUIDCD03072018=3316667864219931; ClicktaleReplayLink=https://dmz01.app.clicktale.com/Player.aspx?PID=1011&UID=3316667864219931&SID=3316667864219931; _uetvid=f9c629e0c26711eb9249a155e0aad6cb; _ga=GA1.2.1205331116.1622517766; aamoptsegs=aam%3D12322074%2Caam%3D12321301; aam_uuid=11062451314358537881498287062699608140; _CT_RS_=Recording; AMCV_EA76ADE95776D2EC7F000101%40AdobeOrg=1585540135%7CMCIDTS%7C18800%7CMCMID%7C11523789172275074111472328214423920963%7CMCAAMLH-1624949889%7C4%7CMCAAMB-1624949889%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCCIDH%7C1839229455%7CMCOPTOUT-1624352289s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-18807%7CvVersion%7C4.4.0; mbox=PC#570cfa7d5e7e42c4ae0d0d71227db183.34_0#1658531789|session#552e3522caea40a38b57f00f6b470e2f#1624346939; _cs_id=9e573d8b-16c5-a65c-f1b1-125df70667b4.1622074930.14.1624345090.1624345079.1613561419.1656238930741.None.1; __CT_Data=gpv=33&ckp=tld&dm=microsoft.com&apv_1067_www32=31&cpv_1067_www32=31&rpv_1067_www32=31&apv_1011_www32=2&cpv_1011_www32=2&rpv_1011_www32=2; me-ct=1; MSNRPSShare=1; ANON=A=3547CB54ACF2832A5CCBAE8BFFFFFFFF&E=19a3&W=1; NAP=V=1.9&E=1949&C=yrKQqffXFyFP_k_xf6JBdWpCCuUWdeukNxquY2OV7aPCflBsyidOCA&W=1; ASP.NET_SessionId=dvdfm0jqwhauwjiedcieonjb; InsiderGroups=2747c49045b247bc-; fptctx2=H3ihr9e92IdW6yd1ZgQ9S1THFw%252fCA4%252b39Yv4fT4Lf4BdL9sXK8kVTcNpulgKfkVXR0kxrN4%252fzbltkDFMqdTV%252baMemGPCFpOOBtbeKiPA6lR75hojAjzWYtCifV%252fAyAf%252bZSG4Z3cIEm1XkGJUxaRXYD%252fR6P4HtSYEF3FrUwwzIPbQ6UPf9QFfjkwQunfnZsTkfYq%252fplY3qqZneMgrZbf7zJIOhm%252fi9gMQcXKh%252fcj%252bpwiI0lXFC6VIv4BaGgCdb3Rig4mY31QfHWvGm4imxqJqXwlxZc6QyJ8AeJdkCtLSjX4%253d; ANON=A=CAAF345D8AE8E86C46311BFBFFFFFFFF&E=19a3&W=1; NAP=V=1.9&E=1949&C=yrKQqffXFyFP_k_xf6JBdWpCCuUWdeukNxquY2OV7aPCflBsyidOCA&W=1; MSCOMRPSSecAuth=FACaBxRUzyIE6vaYt7Vsn1ezurwSQOtYJQNmAAAEgAAACEnXyKek/oD6WAcTnrMHXuBFt/ksAvwS1xRmEcMBo0jRRpsuS9niP6kpnUPrVEE2Pz9Jz0e0LkrH0rgDG6ZrMndXHmV6v0l5H7p%2BrlMDUOEcvsnC8v72NXEe2YS604qYBzA0ZGNPJICZKDzAlMG8a0%2B9T8wFwX34fFB%2BUTiQgzZnPFLpe7DjS/u5Ch2gHS6AQ%2B8CwwgS4m4iendsWQYxFvnGGACoD32ngGfTcEKfgZdTIkXFyBAE5HEYRypoklu1FHQ5ViuAZwjCMwPmTMFd15%2BI2t62EH2zkB5khCQZT2%2BTElFpjeG7L6aX2JAnSpnaE05LfD8eN1qN9CEvLRCIOODXGhWourMdZ8hQN1wRieTwL7Gt5qqXowL%2BIJstnHaODaWkGnM84uDMBC882Go%2BihiLsTe9x7xYCI1Zeq%2BqTGDCuWDjoUDGBqvKjY6qRj%2BxffXB3xJsdmAYf28axBScpVHFRCp3JEKDSrz07GPZuAkHMGijyIF62C6eqaGEL76OuWJjqguU/mzJPq17J9XW2m797V9A%2B86LG5f0vt4%2Bpy43DmDiZUeJEUszbm3uuMko/1NKl8PS0%2BfR/89GpCIzB/rgfMcIN32YsUDFOL9s8tVjN1calINlPv8qI5ewL3EoQxPyV3pxb2Nwij93EXxVNFn69qZwEUdyRiSCmP9gIGwA5y8DZfuHLxOhm3Pp3H/UMx85zBBkdLOiIRURc3M/D4gVts7P1Q85fn5Oy7kq8JE1ZjLuRWBdC4nY/AErJJlksKQl0bYowodDBsVyCAg0/PnLPMC%2BB/KS7IoOBYAXD4Oec7x2goEd4GHC6Kiom6EWdIU%2BCN22%2Bi%2BLysKXm1EzOznahI%2BR/QhV1BprPfqf82FIIqhWn/3OpTDOldfFi/qT4reX79AfTv0H6yQibRnFcljHJAUPkUmh3twWLFe%2Bx1AAaWOSj3l0i/EqFJhQLYoqr6I/3tU%2BSUVZsljiLmUk/8%2BGAmTJ9kJ2xKH/9Wt5iHXgShB%2BrLg2lBUgT1oUSlGc8TiwOuZhJkRMa9USBJEzV3tUIYnIJgJZJv/fPQthrXGxAwhfegQ5HCAJXEGW7bJmN4ZXFzCJ9zn8GJqP6prSdifGY81FSmv/mIAjerlEkbACJzDD9GQIP7HYUcL01lT/Uy9xNB/Np%2Bb3PrKAXR60EkaXPGIOfIUz376Q2q0or/CxrkJQMM1168BMpv%2BjyB96GdEHJEne%2BhMDejR9HZSUNVAxvBWQ27oqXQZUfwOvLYOk6Oa31YBFP09%2Bwlsz2E19A4dE0wWq4u6a8PHNoDEoGMKbbL%2BrAs4T%2Bf7IVHOA4bYQK5u2s9CRg7rmuJjaxP5dvbgceGvlq2isoZvdqIO47ulA7GUnrD493GG6AZ%2BojOO0XTQbXxPrh3T0XusIVoTBtdGFOH8EaXO0TSCPewrGCBeLr31b5A6MKj3RssqVlcfAyEWWWbfj2eyhM1bUIARbvXCjURQr0IHqjSqO2xzqDCFEbe1c26AG1Ols1l%2Br4lEf35QD07xLl6yNhRdgvzmbFu3Pj%2ByGlXVPsqyfyayMiixHBwD4T9QwHgZcQ55vTtYMw8kzq/vP5k1fecAfUbMXxqCn2oJsmggrNuNU0zuowdcnkNiu9FgPjiA%2BxMruUJ2jSocb1WLUdYLk2ih1ybiUGSAg5pGffHF7RpzVIzA//pNUcdR0NeYG2LQM8gmagzL3qDO5xhrE038E0k7O/nsaNGl7DqeJ8oliXPNVoAiWw4IBMGBYUUc1ooutSKsEn8ovXQC/M7TSWZDGHRINOFJPCiCNQk0FSIGJVkXE2swNUZx9Xl89eMW2gFKyXXg1ju84/vaIcVN1oPKL9S6T1iRhfCUfKsa8NA0eoJ9z0mb%2B5n%2BkgXEOpsvs7MBWT1gmLkokZnZC09iYyH2k78FKERO4WiuaOFmWndWSo5Kx2l/RLa4Rw1Us6TIr5TItOKmrH5TWqRG2w%2BEvVub/yynMvVhOvwh/CsKR0AFoozvH0oA8wPgM%2Bo8/hHRHId7yPbuf3Mhiit8LCRUOPJrwAeqvxf/Pr%2B5s6GMy8m7Y1KikX7kd6zamp7/41vwnHf4gxks/F821d6pUK7mBxzI4dACZNckuCl4%2BeI6toxflzTZDK%2BlDojQO/YXYNAIWtw2fgsflcdMuYfk/k3nijMWGrdYZsa9maBawJ7j1pkzGWYaNHXbSNthYCC7jfQGm9qRwjkGSckMi8HOvGnNbNfQGLxaC9w3kPRlaEBiHo2qUx2tIPMFQPC4GeB9mHLLwEurEzhdztNL3O8n%2Bj%2BeNaaqqXvhSgMlG5G5qXI8RXKGOiQlNCJt6hLCO%2BPI3sj%2BY7KIxXs0h/JqVip7M1WbO48OAOl3%2BtOKCUpsj9pIMDXQCWKmj31hdBhq0ATdHwSkt56%2BPn/V5ofQK4gIU4MH1Y3kwf4zlKZISL0SWuNFh9eexzVFGmM9xRJM5vo4Bv5ggZ5yMaFXtptjilW1slqgQvpC3i8DJDa0XuZUGAHciasFUeTD4u8JCvV37bRQAC%2B41Q6Fo6AxB4tE/1brNz4WIQ/Q%3D; MSPAuth=2OWYFtiAMFLsfqiI3DDxWA3iL5pCKGwYjogYEaLKAJi35t7V7eYA9N2Zon1!GycYijL7kEPPiHGVqd0BUf6JpDjydAVO40JYfToK6l!Szy*QGRCPy24skX3mxcTnphhWbuscpZHf8ZGtgZVWECz1kxXPoP5IYpREio; MSPProf=2qxWw1YI9HxQxXqK0724l6vR!GG3fyiEhIYe12jRhyhrzzgvV5bePisCoVCdsz7fFasNoXWp4X2!UtNJ3vGIynrz4gtncsVebOCurHUjIkOUL1YthMN0G6xhA0kQIKBwx*WuIP3yiZIMu5UE2*PMSFnf5!vOJ!8FbxNN!NIjMoRagYX9kjzV4mzkqir41hrm9pM6sjaUaTie4xoFaPgT6cmw$$; MS0=5b6ab3bf4b184d709f8a916e4774449c; MS-CV=Qaizb+LFtUq+PlU4.4.0"
        }
    }).then((response) => {
        return response.data.metadata.mscomct;
    })

    res.status(200).json({ 'Authorization': response })

}