import axios from "axios";
import Cors from 'cors'


const cors = Cors({
    methods: ['GET', 'HEAD', 'POST'],
})

function runMiddleware(req, res, fn) {
    return new Promise((resolve, reject) => {
        fn(req, res, (result) => {
            if (result instanceof Error) {
                return reject(result)
            }

            return resolve(result)
        })
    })
}

export default async function handler(req, res) {

    await runMiddleware(req, res, cors);

    const response = await axios.get('https://redeem.microsoft.com/webblendredeem?lang=en-US&market=US&control=redeem&mock=false&metadata=mscomct&lang=en-US&cid=a78287f79f56ddc1&xhr=true&X-Requested-With=XMLHttpRequest&_=1631220581345', {
        headers: {
            Cookie: `MC1=GUID=c16b320d2afc4ddeb22394adbfc0adab&HASH=c16b&LV=202105&V=4&LU=1622066764682; _mkto_trk=id:157-GQE-382&token:_mch-microsoft.com-1622074930494-30943; WRUIDCD03072018=3316667864219931; ClicktaleReplayLink=https://dmz01.app.clicktale.com/Player.aspx?PID=1011&UID=3316667864219931&SID=3316667864219931; _ga=GA1.2.1205331116.1622517766; _fbp=fb.1.1624584421901.1136163943; IR_PI=a0a71ceb-ddce-11eb-b30b-a123e6f5a3be|1625602909297; display-culture=en-US; MSCC=cid=ts7b2c5higvuiw6oldujkkcs-c1=2-c2=2-c3=2; _cs_c=0; LPVID=EzMjJkODc2YTEyZGEzMTdh; NAP=V=1.9&E=1972&C=EbN371gzVf4yHezRELAcVpVGVBxL2tN6pCMWE4ZLTjocISOkUJTbrQ&W=a; aam_uuid=33068285850847972413634353341059332090; _clck=1nikvr0|1|etu; WRUID=3309642234806449; _CT_RS_=Recording; MUID=10E1011E62B967790FF01189636C66C0; ANON=A=CAAF345D8AE8E86C46311BFBFFFFFFFF&E=19db&W=e; ANON=A=CAAF345D8AE8E86C46311BFBFFFFFFFF&E=19db&W=e; NAP=V=1.9&E=1981&C=v4Yzc02Ce4DaCX5tiZiUJKxSi0ndpRbBZXR18VnFPMUnSPZrk-YDHw&W=d; _uetvid=f9c629e0c26711eb9249a155e0aad6cb; AMCV_EA76ADE95776D2EC7F000101@AdobeOrg=1585540135|MCIDTS|18878|MCMID|32606165887524311583660282503796334325|MCAAMLH-1631587963|4|MCAAMB-1631587963|6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y|MCCIDH|1558211478|MCOPTOUT-1630990363s|NONE|MCAID|NONE|MCSYNCSOP|411-18882|vVersion|4.4.0; mbox=PC#570cfa7d5e7e42c4ae0d0d71227db183.34_0#1665169863|session#f5b172bb07544d59bc01ca50bb7cafa0#1630985024; _cs_id=9e573d8b-16c5-a65c-f1b1-125df70667b4.1622074930.27.1630983167.1630983167.1613561419.1656238930741; __CT_Data=gpv=54&ckp=tld&dm=microsoft.com&apv_1067_www32=43&cpv_1067_www32=43&rpv_1067_www32=43&apv_1011_www32=5&cpv_1011_www32=5&rpv_1011_www32=5&apv_1009_www32=4&cpv_1009_www32=4&rpv_1009_www32=4; me-ct=1; InsiderGroups=a78287f79f56ddc1-insider; MSCOMRPSSecAuth=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; MSNRPSShare=1; MSPAuth=2ae*MHrdLG9AL8y0piUopcGI0GTj6pfJ1eCwxEbqzMOVclK!Fi3JiSspcryzfoPxuKkhTnC0HFGEHcbFKAlCwkDgMMUrNPSVet4QkwLH35ZfAFP4kda3IWxs9cdW9G7!LLIvXHRmYT31s$; MSPProf=2TW5aYMnIF3uvw4On24qurURQRybk1*xeo0WV4wXfA814aUaBuKdA94ojgqh5PBQui6brOnDDWXMe1XE5wL6z64DOpHGV*PWsDF7dLVNmBp*wTsJaTm*v1guKVyDHO8!wKq76cndk*HvZF3I1ySHkvqPbL6qPMHdWUG7qa7BTTfg*kzJzD67vDSufVWQGpGYLeFGOa8C1Qqr3SsrqFxJdiAUcFMd1RXFhL; ASP.NET_SessionId=bqzmrp221100vy4sgbltrsrx; fptctx2=H3ihr9e92IdW6yd1ZgQ9Sz4bj6XMGo9empP83sM5ewdWRaoc8v%2bx2Ln3HD%2b1F8wT7kUvVJOPUrfECjG8WNSY52ZHAciF1v4ni23%2fd8Ptrc6uBsUQykhLZoRcwBCzEuIYpRG0u2bAL6Qx4%2fPQjK6FkjsjfNm%2fyTr%2fwaWc%2f7W1OQSPDNj%2fC1sNkU%2fZ2jZj2XST%2f6KRlcxkcL6wY8IpPD8v8d3%2b%2bJvNZ3w%2fA2QeQIpxpckSvZGJnZOhR%2bQ8GswMjNfD6wxgg%2b1DTEZ%2bW4oAQNCscWB7Mlzfmrn%2bauaEkB2kGf4%3d; MS0=0a71cd7a02b6497880334f73a9cf7246; MS-CV=ENGpRhnlz028POHV.1.0`
        }
    }).then((response) => {
        return response.data.metadata.mscomct;
    })
    res.status(200).json({ 'Authorization': response })
}